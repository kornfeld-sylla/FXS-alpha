Code for analysis of the 1/f fit of EEG signals from mouse and human. The code uses the same math as previously published code from the Voytek Lab at UCSD (SpecParam, https://fooof-tools.github.io/fooof/), namely Lorentzian Functions, but SpecParam has difficulty fitting the signal well at the lowest frequencies and between 10-20 Hz and often estimates underlying 1/f power in these regions. This code tailors the fit specifically to these troublesome regions for an improved 1/f fit.

This code requires MATLAB, and was developed in version R2018b, and subsequently edited in R2022b by adding a built-in function for calculating effect size that is only available in MATLAB versions from 2022 on. This code also calls on functions from the Chronux Toolbox for signal processing. Please download Chronux version 2.12 here: https://chronux.org/

To use this code, simply execute run_improved_EEG_fit.m. To execute, you need to have all the dependencies in the path, including the Chronux code, and the data in the current folder. The run time with the example data and using "random" mode for bootstrapping is about 38 seconds. Run time with the example data and using "deterministic" mode with our pre-set seed .mat files (must be added to the current folder from FigShare) is about 218 seconds. Run time with the example data and using "deterministic" mode and generating new seed arrays (specific to the size of the sample data) is about 88 seconds (including time at the end to save the arrays, 72 seconds run time if the user chooses not to save the generated seed arrays). 

There are several user-defined parameters at the top of rum_improved_EEG_fit.m. The code will execute properly with the parameters as they are, but they are modifiable. With the first parameter, the user selects which time-series datasets to analyze. The code will automatically run with the example data in GitHub, but the user can analyze the other listed dataset by adding it to the current folder from FigShare and uncommenting those data files (and commenting out the example files). The FXS files are always assigned to sheet 1 to precisely reproduce the graphs in the manuscript. With the second parameter, the user indicates the length of the time series segments they would like to analyze in the frequency domain (in this paper, we used 5s for mice, and 2s for humans). This parameter must be 5s for the example data in this Github. With the third parameter, the user can indicate the frequency range over which you want to fit the 1/f, the default is [2 55] which is what we used for mice (for humans, we used [3 55]). However, it is possible to fit out to higher frequencies, even if there is a 60 Hz notch filter. The highest frequency you can fit out to is the largest frequency unaffected by any low pass filtering. The next parameter allows you to set the number of periodic peaks to analyze. Mice have one periodic peak, humans have 2, so the default is 1 here. The following parameter allows you to indicate the frequency resolution you would like to have for the multi-taper power spectrum, which must be an even number greater than or equal to 2 (recommended, default). Finally, the last parameter controls the confidence interval you want for bootstrapping. Accepted values are 95 and 99. We recommend 99 fo mice (default) and 95 for human data.

Dependencies: This code calls on improved_EEG_fit.m to calculate the power spectra from the given time-series. This code calls upon another script, st_fit_EEG.m, which finds the aperiodic fit for the average power spectrum per subject and also finds the center frequencies and powers of the periodic peaks. It will find these peaks through automated methods, but may ask you to confirm an unusal peak value by entering yes (1) or no (0). Instructions for this process will pop up in the command window as you run the code.

Additional dependencies: For plotting power spectra, correcting for multiple comparisons, and running bootstrap statistics, the code also calls on plot_spectrum_two_group.m, FDR_correct.m, and fg_bootstrap_two_groups.m when running "random" mode for bootstrapping. When using "deterministic" mode, the code will instead call on fg_bootstrap_two_groups_seed.m, and if the user decides to generate their own seeds for random number generation in "deterministic" mode, the code will also call on makeseed.m.
